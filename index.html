<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Link Device</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { 
      font-family: sans-serif; 
      text-align: center; 
      margin-top: 60px;
    }
    input { 
      padding: 8px; 
      font-size: 16px; 
      width: 220px;
    }
    button { 
      padding: 8px 18px; 
      font-size: 16px; 
      margin-left: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <p>Enter your Glide User ID to link your device:</p>
  <input type="text" id="userIdInput" placeholder="Enter your User ID">
  <button onclick="linkDevice()">Link Device</button>

  <script>
    const redirectUrl = "https://thebetpoint.app/dl/063968";

    // ✅ WebToNative JS Override for setting external user ID
    window.WTN = window.WTN || {};
    window.WTN.OneSignal = {
      setExternalUserId: function(id) {
        try {
          // Android bridge
          if (window.Android && typeof window.Android.setExternalUserId === "function") {
            window.Android.setExternalUserId(id);
            console.log("✅ Android externalUserId set:", id);
          }
          // iOS bridge
          else if (window.webkit?.messageHandlers?.setExternalUserId) {
            window.webkit.messageHandlers.setExternalUserId.postMessage(id);
            console.log("✅ iOS externalUserId set:", id);
          } 
          // Retry if bridge not ready yet
          else {
            console.warn("❌ Bridge not ready, retrying...");
            setTimeout(() => window.WTN.OneSignal.setExternalUserId(id), 200);
          }
        } catch (err) {
          console.error("Error setting external user ID:", err);
        }
      }
    };

    // ✅ Link device function
    function linkDevice() {
      const userId = document.getElementById("userIdInput").value.trim();
      if (!userId) {
        alert("Please enter your User ID.");
        return;
      }

      try {
        // Call the override bridge method
        if (window.WTN?.OneSignal?.setExternalUserId) {
          window.WTN.OneSignal.setExternalUserId(userId);
          alert("Device linked successfully!");
        } else {
          console.warn("WTN bridge not available, retrying...");
          setTimeout(() => window.WTN.OneSignal.setExternalUserId(userId), 300);
        }
      } catch (e) {
        console.error("Error linking device:", e);
      }

      // Redirect after 1 second
      setTimeout(() => {
        window.location.href = redirectUrl;
      }, 1000);
    }
  </script>
</body>
</html>
